<h3>Fascicoli</h3>

<% if (typeof message !== 'undefined' && message) { %>
  <div class="alert alert-danger"><%= message %></div>
<% } %>

<form method="GET" action="/fascicoli" class="row g-2 mb-4">
  <div class="col-md-5">
    <input type="text" name="cognome" class="form-control" placeholder="Filtra per Cognome" value="<%= filters.cognome %>">
  </div>
  <div class="col-md-5">
    <input type="text" name="nome" class="form-control" placeholder="Filtra per Nome"    value="<%= filters.nome     %>">
  </div>
  <div class="col-md-2 text-end">
    <button class="btn btn-primary w-100">Filtra</button>
  </div>
</form>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Foto</th>
      <th>Anagrafica</th>
      <th>Data Nascita</th>
      <th>Comune</th>
      <th>Cellulare</th>
      <th>Fascicolo</th>
    </tr>
  </thead>
  <tbody>
    <% anagrafiche.forEach(a => { %>
      <tr>
        <td>
          <img src="<%= a.foto || defaultPhoto %>" 
               alt="Foto <%= a.nome %>" 
               class="img-thumbnail" 
               style="width:60px;height:60px;object-fit:cover;">
        </td>
        <td><%= a.nome %> <%= a.cognome %></td>
        <td><%= a.data_nascita.toISOString().split('T')[0] %></td>
        <td><%= a.luogo_nascita %></td>
        <td><%= a.cellulare %></td>
        <td>
          <button type="button" 
                  class="btn btn-sm btn-info btn-view" 
                  data-id="<%= a.id %>">
            üëÅÔ∏è
          </button>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<div id="fascicolo-detail" class="mt-4"></div>

<script>
  document.querySelectorAll('.btn-view').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.id;
      fetch(`/fascicoli/${id}`)       // dovrai aggiungere una rotta /fascicoli/:id
        .then(res => res.text())
        .then(html => {
          document.getElementById('fascicolo-detail').innerHTML = html;
        });
    });
  });
</script>