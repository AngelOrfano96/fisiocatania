<h3>Allegati per terapia</h3>

<p>
  <strong>Terapia del:</strong>
  <%= therapy.data_trattamento.slice(0,10) %> — 
  <%= therapy.anagrafica.nome %> <%= therapy.anagrafica.cognome %>
</p>

<hr>

<h5>Upload nuovo allegato</h5>
<form method="POST" action="/terapie/<%= therapy.id %>/allegati" 
      enctype="multipart/form-data" class="mb-4">
  <div class="input-group" style="max-width:400px;">
    <input type="file" name="allegato" class="form-control" required>
    <button class="btn btn-primary" type="submit">Carica</button>
  </div>
</form>

<h5>Allegati esistenti</h5>
<% if (attachments.length === 0) { %>
  <p class="text-muted">Nessun allegato caricato.</p>
<% } else { %>
  <ul class="list-group">
    <% attachments.forEach(a => { 
         // estraggo il nome del file dall'URL
         const filename = a.url.split('/').pop();
    %>
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <a href="<%= a.url %>" target="_blank">🖼️ <%= filename %></a>
        <form method="POST" action="/allegati/<%= a.id %>/delete" 
              onsubmit="return confirm('Eliminare questo allegato?')">
          <button type="submit" class="btn btn-sm btn-danger">🗑️</button>
        </form>
      </li>
    <% }) %>
  </ul>
<% } %>

<p class="mt-4">
  <a href="javascript:history.back()" class="btn btn-secondary btn-sm">← Indietro</a>
</p>
